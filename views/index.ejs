<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Search</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Plotly.js (for plotting graphs) -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        a {
	        color: #0254EB
        }
        a:visited {
          	color: #0254EB
        }
        a.morelink {
	        text-decoration:none;
         	outline: none;
        }
        .morecontent span {
	        display: none;
        }
        .comment {
	       width: 400px;
	       margin: 10px;
        }
    </style>
</head>
<body>
    <div class="container mt-5 mb-5">
        <h1 class="mb-4">Stock Search</h1>
        <!-- Search form -->
       <%- include("partials/search_form.ejs") %>
       <% if(locals.data){%>
        <%  %>
        <!-- Panel to display stock information and graph -->
        <%- include("partials/stock.ejs") %>
        <%} else if(locals.error){%>
            
            <div class="card border-danger">
                <div class="card-body">
                    <h5 class="card-title text-danger"><%= error %></h5>
                    <h6 class="card-subtitle text-success">Note: <%= note %></h6>
                </div>
            </div>
            
            <%}%> 
    </div>
  
 <script>
    document.addEventListener('DOMContentLoaded', function () {
    var showChar = 100;
    var ellipsestext = "...";
    var moretext = "more";
    var lesstext = "less";

    var moreElements = document.querySelectorAll('.more');

   moreElements.forEach(function (element) {
        var content = element.innerHTML;

        if (content.length > showChar) {
            var visiblePart = content.substr(0, showChar);
            var hiddenPart = content.substr(showChar , content.length - showChar);

            var html = visiblePart + 
                       '<span class="moreellipses">' + ellipsestext + '&nbsp;</span>' + 
                       '<span class="morecontent"><span>' + hiddenPart + '</span>&nbsp;&nbsp;' + 
                       '<a href="" class="morelink">' + moretext + '</a></span>';

            element.innerHTML = html;
        }
    });

    document.addEventListener('click', function (event) {
        if (event.target && event.target.classList.contains('morelink')) {
            event.preventDefault();

            var morelink = event.target;
            if (morelink.classList.contains('less')) {
                morelink.classList.remove('less');
                morelink.innerHTML = moretext;
            } else {
                morelink.classList.add('less');
                morelink.innerHTML = lesstext;
            }
    
            morelink.parentNode.previousSibling.style.display = morelink.classList.contains('less') ? 'none' : 'inline';
            morelink.previousSibling.previousSibling.style.display = morelink.classList.contains('less') ? 'inline' : 'none';
        }
    });
});

function searchStock() {
            const stockSymbol = document.getElementById('stockInput').value.trim().toUpperCase();
            
            // Fetch stock data (You can use a real API to get stock information)
            // For demonstration purpose, using mock data
            
            console.log(stockHistory[0].date)

            const mockStockData = {
                name: 'Apple Inc.',
                price: '$235.75',
                timeline: {
                    dates: ['2024-05-01', '2024-05-02', '2024-05-03', '2024-05-04', '2024-05-05'],
                    prices: [235.5, 237.3, 234.8, 236.2, 238.1]
                }
            };
         
       
            // Display stock graph using Plotly.js
            const dates = mockStockData.timeline.dates;
            const prices = mockStockData.timeline.prices;

            const trace = {
                x: dates,
                y: prices,
                type: 'scatter',
                mode: 'lines+markers',
                marker: { color: 'blue' },
                name: 'Stock Price'
            };

            const layout = {
                title: 'Stock Price Timeline',
                xaxis: { title: 'Date' },
                yaxis: { title: 'Price ($)' }
            };

            const config = { responsive: true };

            Plotly.newPlot('stockGraph',[trace], layout, config);

            // Show the stock info panel
            document.getElementById('stockInfoPanel').style.display = 'block';
        }

        searchStock()
 </script>
</body>
</html>
